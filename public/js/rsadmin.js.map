{"version":3,"file":"rsadmin.js","sources":["../../src/rsadmin.js"],"sourcesContent":["import van from \"vanjs-core\";\nimport { firestore, collection, getDocs } from \"./rsdb.js\";\n\nclass Admin {\n    constructor() {\n        this.statusLabels = [\n            \"requested\",\n            \"processing\",\n            \"waiting\",\n            \"failed\",\n            \"completed\",\n        ];\n    }\n\n    async init() {\n        this.addElements();\n        this.initJobsChart();\n        await this.updateJobsChart();\n    }\n\n    addElements(parentElement) {\n        const { a, div, main, h1, canvas } = van.tags;\n        parentElement =\n            parentElement ||\n            document.getElementById(\"container\") ||\n            document.body;\n\n        van.add(\n            parentElement,\n            main(\n                { class: \"w-[90%] p-4 overflow-auto\" },\n                div({ class: \"flex justify-center items-center\" }, h1(\"Admin\")),\n                div(\n                    {},\n                    canvas({\n                        id: \"admin-jobs\",\n                        width: 640,\n                        height: 360,\n                    })\n                )\n            )\n        );\n    }\n\n    async getJobsByStatus() {\n        const colRef = collection(firestore, \"jobs\");\n        const snapshot = await getDocs(colRef);\n\n        let result = {\n            requested: { status: \"requested\", count: 0, jobs: [] },\n            processing: { status: \"processing\", count: 0, jobs: [] },\n            waiting: { status: \"waiting\", count: 0, jobs: [] },\n            failed: { status: \"failed\", count: 0, jobs: [] },\n            completed: { status: \"completed\", count: 0, jobs: [] },\n        };\n\n        snapshot.forEach((doc) => {\n            let data = doc.data();\n            let status = result[data.status];\n            status.count += 1;\n            status.jobs.push(data);\n        });\n\n        return result;\n    }\n\n    initJobsChart() {\n        const canvas = document.getElementById(\"admin-jobs\");\n        const ctx = canvas.getContext(\"2d\");\n\n        if (this.jobsChart) this.jobsChart.destroy();\n\n        this.jobsChart = new Chart(ctx, {\n            type: \"bar\",\n            data: {\n                labels: this.statusLabels,\n                datasets: [\n                    {\n                        label: \"Status\",\n                        data: this.statusLabels.map(() => 0),\n                        fill: true,\n                        borderWidth: 1,\n                        borderColor: \"red\",\n                        backgroundColor: \"red\",\n                    },\n                ],\n            },\n            options: {\n                indexAxis: \"y\",\n                responsive: false,\n                plugins: {\n                    legend: {\n                        display: false,\n                    },\n                },\n            },\n        });\n        this.jobsChart.update();\n    }\n\n    async updateJobsChart() {\n        let jobs = await this.getJobsByStatus();\n        let data = this.statusLabels.map((label) => jobs[label].count);\n\n        this.jobsChart.data.datasets[0].data = data;\n        this.jobsChart.update();\n    }\n}\n\nconst admin = new Admin();\nexport { Admin, admin };\nwindow.admin = admin;\n"],"names":[],"mappings":"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"}